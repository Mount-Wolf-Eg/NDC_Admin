<template>
  <div>
    <ReusTable
      :header="[
        '',
        'Name',
        'Email',
        'Mobile',
        'Role',
        'Created',
        'Status',
        'Action',
      ]"
    >
      <template #table>
        <tr v-for="admin in allAdmins" :key="admin.id">
          <td>
            <div class="form-check form-switch">
              <input
                :checked="!admin.deleted_at"
                @change="toggleStatus(admin.id, $event)"
                class="form-check-input"
                type="checkbox"
                role="switch"
                id="flexSwitchCheckDefault"
              />
            </div>
          </td>
          <td>{{ admin.name }}</td>
          <td>
            <a :href="`mailto:${admin.email}`">{{ admin.email }}</a>
          </td>

          <td>{{ admin.phone }}</td>
          <td>{{ admin.role ? admin.role : "..." }}</td>
          <td>
            {{ moment(new Date(admin.created_at)).format("DD-MM-YYYY") }}
          </td>
          <td
            v-if="!admin.deleted_at"
            style="color: var(--col-success) !important"
          >
            Active
          </td>
          <td v-else style="color: var(--col-error)">Suspended</td>
          <td style="width: 15%">
            <div class="center-row justify-content-between align-items-center">
              <button type="button" class="btn border-0">
                <svg
                  class="qr-btn"
                  style="width: 2rem; height: 2rem"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <g clip-path="url(#clip0_546_276)">
                    <path
                      d="M15.1513 19.9969C14.3185 19.9969 13.4857 20.001 12.654 19.9958C12.0388 19.9917 11.6693 19.6773 11.6651 19.1702C11.6599 18.659 12.0273 18.3321 12.6374 18.33C14.1988 18.3248 15.7592 18.33 17.3206 18.3269C18.0587 18.3259 18.3252 18.0614 18.3272 17.3295C18.3304 16.0635 18.3252 14.7965 18.3293 13.5305C18.3314 12.8777 18.6468 12.4977 19.1683 12.5008C19.6888 12.5039 19.9938 12.8808 19.9959 13.5398C19.999 14.8579 20.0053 16.177 19.9938 17.4951C19.9824 18.9412 18.9404 19.9781 17.4924 19.9958C16.7117 20.0052 15.931 19.9979 15.1513 19.9979V19.9969Z"
                      fill="#464A61"
                    />
                    <path
                      d="M4.89877 19.9948C4.1014 19.9948 3.30506 20.0031 2.50768 19.9927C1.07636 19.974 0.0208256 18.9193 0.0072931 17.4847C-0.00519844 16.151 0.00104733 14.8162 0.00625214 13.4826C0.00833406 12.8683 0.325827 12.5018 0.833817 12.4987C1.34077 12.4956 1.66867 12.8673 1.67075 13.4742C1.677 14.7569 1.67075 16.0385 1.67387 17.3212C1.67595 18.0417 1.9591 18.3228 2.68361 18.3248C4.25962 18.329 5.83668 18.328 7.4127 18.3248C7.81971 18.3248 8.11639 18.4873 8.27357 18.8673C8.40681 19.189 8.32666 19.4815 8.09765 19.7314C7.8957 19.9521 7.63026 20.001 7.33983 19.9979C6.5258 19.9906 5.71176 19.9948 4.89669 19.9948H4.89877Z"
                      fill="#464A61"
                    />
                    <path
                      d="M15.1119 0.00415984C15.9082 0.00415984 16.7056 -0.0062514 17.5019 0.00728321C18.9093 0.0291468 19.97 1.07444 19.9888 2.47371C20.0065 3.82509 19.9971 5.17542 19.9919 6.5268C19.9888 7.1317 19.6567 7.50546 19.1518 7.5013C18.647 7.49713 18.3336 7.12441 18.3263 6.51327C18.3222 6.18427 18.3534 5.85216 18.3201 5.52628C18.1994 4.3217 18.6105 3.08068 18.0734 1.90525C16.8919 1.39823 15.6532 1.78136 14.4456 1.68037C13.8783 1.63248 13.3037 1.67412 12.7322 1.67204C12.0514 1.66892 11.6538 1.34825 11.6684 0.817278C11.6819 0.301921 12.0608 0.00728321 12.7229 0.00415984C13.5192 0.00103647 14.3166 0.00415984 15.1129 0.00415984H15.1119Z"
                      fill="#464A61"
                    />
                    <path
                      d="M5.00538 1.67309C4.2257 1.67309 3.44498 1.66789 2.6653 1.67518C1.98867 1.68142 1.67951 1.98751 1.67638 2.66216C1.67014 3.92817 1.67638 5.19418 1.67326 6.45914C1.67118 7.11713 1.36722 7.4961 0.847777 7.50131C0.325215 7.50651 0.0077213 7.12546 0.00668034 6.47476C0.00355745 5.17439 -0.00268832 3.87403 0.0077213 2.57367C0.0191719 1.08798 1.08303 0.0187466 2.57057 0.00729424C4.16532 -0.00519925 5.76008 0.00104749 7.35587 0.00625311C7.96171 0.00833536 8.33646 0.340454 8.33333 0.845399C8.33021 1.35139 7.95755 1.66789 7.3465 1.67205C6.56682 1.67726 5.7861 1.67309 5.00642 1.67309H5.00538Z"
                      fill="#464A61"
                    />
                    <path
                      d="M14.1663 8.33419C14.1663 8.87141 14.1768 9.40863 14.1632 9.94481C14.1497 10.5008 13.8426 10.8225 13.293 10.8298C12.2197 10.8443 11.1455 10.8433 10.0722 10.8298C9.52469 10.8235 9.19055 10.5029 9.18222 9.9573C9.16452 8.8839 9.16452 7.80946 9.18222 6.73606C9.19159 6.16553 9.52678 5.85111 10.1108 5.84486C11.1496 5.83341 12.1885 5.83341 13.2274 5.84486C13.8416 5.85111 14.1528 6.16761 14.1653 6.77459C14.1757 7.29411 14.1674 7.81363 14.1674 8.33315L14.1663 8.33419ZM12.4987 8.35085C12.4987 7.79211 12.2878 7.5124 11.8658 7.5117C11.1864 7.5117 10.8467 7.73346 10.8467 8.17698C10.8467 8.83636 11.0771 9.16605 11.5379 9.16605C12.1791 9.16605 12.4998 8.89432 12.4998 8.35085H12.4987Z"
                      fill="#464A61"
                    />
                    <path
                      d="M8.3349 5.82822C8.3349 6.33108 8.34011 6.83395 8.33386 7.33577C8.32553 7.98439 8.0247 8.3113 7.39075 8.31963C6.35083 8.33317 5.31091 8.33421 4.27099 8.31859C3.69013 8.31026 3.36327 7.98543 3.3539 7.40865C3.33829 6.35191 3.33725 5.29412 3.3539 4.23738C3.36327 3.65748 3.69117 3.34514 4.27411 3.33889C5.31403 3.32744 6.35395 3.32848 7.39387 3.33889C8.00908 3.3441 8.31929 3.65748 8.33178 4.26862C8.34219 4.78814 8.33386 5.3087 8.33386 5.82822H8.3349ZM5.87719 5.00469C5.30536 5.00469 5.01944 5.22923 5.01944 5.6783C5.01944 6.32865 5.24186 6.65383 5.6867 6.65383C6.33973 6.65383 6.66624 6.41819 6.66624 5.94691C6.66624 5.31876 6.40322 5.00469 5.87719 5.00469Z"
                      fill="#464A61"
                    />
                    <path
                      d="M8.3353 14.1645C8.3353 14.684 8.34362 15.2046 8.33321 15.7241C8.32072 16.305 8.01364 16.6372 7.4359 16.6465C6.37933 16.6642 5.32171 16.6632 4.26513 16.6465C3.68948 16.6382 3.36366 16.3082 3.35533 15.7293C3.34076 14.6726 3.33868 13.6148 3.35637 12.558C3.36574 11.9833 3.69989 11.6731 4.28387 11.6679C5.32379 11.6575 6.36371 11.6575 7.40363 11.6679C8.01364 11.6741 8.3228 11.9917 8.33425 12.6049C8.34362 13.1244 8.33634 13.645 8.33634 14.1645H8.3353ZM5.84011 14.9828C6.39043 14.9828 6.66594 14.7652 6.66663 14.33C6.66663 13.6665 6.45601 13.3344 6.03477 13.3337C5.35745 13.3337 5.01879 13.5749 5.01879 14.0573C5.01879 14.6743 5.29256 14.9828 5.84011 14.9828Z"
                      fill="#464A61"
                    />
                    <path
                      d="M12.8857 3.33578C13.8028 3.33578 14.7199 3.33161 15.637 3.33682C16.3521 3.34098 16.654 3.63666 16.6613 4.3363C16.6665 4.82042 16.6738 5.30558 16.6581 5.78971C16.6415 6.30714 16.2834 6.66633 15.8202 6.66113C15.3569 6.65592 15.0207 6.29465 14.9947 5.77305C14.969 5.26081 14.6994 5.0047 14.1859 5.0047C12.8534 5.0047 11.521 5.00678 10.1886 5.0047C9.53067 5.00366 9.16113 4.69965 9.16113 4.17284C9.16113 3.64603 9.52963 3.34098 10.1865 3.33786C11.0859 3.33369 11.9863 3.33786 12.8857 3.33786V3.33578Z"
                      fill="#464A61"
                    />
                    <path
                      d="M16.6632 14.2114C16.6632 14.7142 16.6704 15.2171 16.6611 15.7199C16.6496 16.3394 16.3457 16.6507 15.7367 16.6632C15.2339 16.6736 14.7311 16.6747 14.2283 16.6632C13.6995 16.6497 13.3425 16.3144 13.3342 15.847C13.3248 15.3556 13.687 15.0193 14.2502 14.9984C14.3543 14.9943 14.4605 14.986 14.5625 14.9995C14.8914 15.0453 15.0205 14.9329 15.0039 14.5789C14.9758 13.9563 14.9903 13.3306 14.9976 12.7059C15.0049 12.0968 15.3297 11.7429 15.8543 11.7564C16.3509 11.7689 16.6548 12.1177 16.6632 12.7028C16.6704 13.2056 16.6642 13.7085 16.6642 14.2114H16.6632Z"
                      fill="#464A61"
                    />
                    <path
                      d="M11.6487 14.1655C11.1293 14.1655 10.6088 14.1759 10.0894 14.1635C9.53765 14.151 9.216 13.8428 9.18165 13.3024C9.16499 13.0432 9.16707 12.7819 9.18165 12.5226C9.20663 12.0708 9.43772 11.7616 9.88742 11.6814C10.3173 11.6054 10.6629 11.8084 10.7868 12.2134C10.8722 12.4935 11.0189 12.5049 11.2355 12.4977C11.4437 12.4914 11.6529 12.4831 11.859 12.4997C12.2181 12.5278 12.4909 12.5133 12.646 12.0739C12.7688 11.7251 13.1456 11.5971 13.5225 11.6918C13.891 11.7834 14.1252 12.0364 14.1574 12.4248C14.1814 12.7173 14.1762 13.0141 14.1637 13.3077C14.1408 13.8303 13.8347 14.1447 13.3132 14.1614C12.7594 14.1791 12.2046 14.1655 11.6498 14.1655H11.6487Z"
                      fill="#464A61"
                    />
                    <path
                      d="M5.81758 10.8444C5.28045 10.8444 4.74331 10.8548 4.20617 10.8412C3.68153 10.8277 3.33177 10.48 3.33697 10.0083C3.34218 9.55753 3.67528 9.19418 4.17078 9.18481C5.27941 9.16398 6.38803 9.16398 7.49665 9.18481C8.01609 9.19418 8.35441 9.57731 8.33567 10.0521C8.31797 10.5091 7.98487 10.8287 7.48 10.8423C6.92621 10.8558 6.37137 10.8454 5.81758 10.8454V10.8444Z"
                      fill="#464A61"
                    />
                    <path
                      d="M16.6614 9.16815C16.6614 9.44405 16.6739 9.72203 16.6583 9.99688C16.6302 10.4852 16.2888 10.8235 15.8401 10.8298C15.3915 10.836 15.0209 10.4997 15.0021 10.0187C14.9803 9.44925 14.9792 8.87872 15.0021 8.30922C15.0219 7.82614 15.3904 7.49402 15.8422 7.50235C16.2909 7.51068 16.6312 7.84904 16.6583 8.33837C16.6739 8.61427 16.6614 8.89121 16.6614 9.16711V9.16815Z"
                      fill="#464A61"
                    />
                    <path
                      d="M10.8508 14.9995C11.1453 14.9995 11.441 14.9807 11.7335 15.0047C12.1894 15.0422 12.5017 15.3941 12.5007 15.8324C12.5007 16.2696 12.1884 16.633 11.7304 16.6549C11.1433 16.6819 10.552 16.6809 9.9649 16.6569C9.48501 16.6372 9.1519 16.254 9.16752 15.8032C9.18313 15.3701 9.50479 15.0359 9.96802 15.0036C10.2616 14.9839 10.5562 14.9995 10.8508 15.0005V14.9995Z"
                      fill="#464A61"
                    />
                  </g>
                  <defs>
                    <clipPath id="clip0_546_276">
                      <rect width="20" height="20" fill="white" />
                    </clipPath>
                  </defs>
                </svg>
              </button>
              <button
                type="button"
                class="btn border-0"
                @click="editUser(admin.id)"
              >
                <svg
                  class="edit-btn"
                  style="width: 2rem; height: 2rem"
                  viewBox="0 0 20 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fill-rule="evenodd"
                    clip-rule="evenodd"
                    d="M17.178 1.80821C16.9091 1.80821 16.6513 1.91502 16.4611 2.10514L8.04922 10.5171L7.57131 12.4287L9.48293 11.9508L17.8949 3.53886C18.085 3.34874 18.1918 3.09088 18.1918 2.822C18.1918 2.55313 18.085 2.29527 17.8949 2.10514C17.7047 1.91502 17.4469 1.80821 17.178 1.80821ZM15.1825 0.826545C15.7118 0.297317 16.4296 0 17.178 0C17.9264 0 18.6442 0.297317 19.1735 0.826545C19.7027 1.35577 20 2.07356 20 2.822C20 3.57044 19.7027 4.28823 19.1735 4.81746L10.5845 13.4065C10.4686 13.5223 10.3234 13.6045 10.1644 13.6443L6.54801 14.5484C6.23992 14.6254 5.914 14.5351 5.68944 14.3106C5.46487 14.086 5.3746 13.7601 5.45163 13.452L6.35573 9.83557C6.39547 9.67659 6.47767 9.53141 6.59354 9.41554L15.1825 0.826545ZM0.794419 2.71232C1.30308 2.20366 1.99296 1.9179 2.71232 1.9179H9.04105C9.54037 1.9179 9.94516 2.32268 9.94516 2.822C9.94516 3.32133 9.54037 3.72611 9.04105 3.72611H2.71232C2.47253 3.72611 2.24257 3.82136 2.07302 3.99091C1.90346 4.16047 1.80821 4.39043 1.80821 4.63021V17.2877C1.80821 17.5275 1.90346 17.7574 2.07302 17.927C2.24257 18.0965 2.47253 18.1918 2.71232 18.1918H15.3698C15.6096 18.1918 15.8395 18.0965 16.0091 17.927C16.1786 17.7574 16.2739 17.5275 16.2739 17.2877V10.9589C16.2739 10.4596 16.6787 10.0548 17.178 10.0548C17.6773 10.0548 18.0821 10.4596 18.0821 10.9589V17.2877C18.0821 18.007 17.7963 18.6969 17.2877 19.2056C16.779 19.7142 16.0891 20 15.3698 20H2.71232C1.99296 20 1.30308 19.7142 0.794419 19.2056C0.285761 18.6969 0 18.007 0 17.2877V4.63021C0 3.91086 0.285761 3.22097 0.794419 2.71232Z"
                    fill="#464A61"
                  />
                </svg>
              </button>
              <button
                type="button"
                class="btn border-0"
                @click="removeUser(admin.id)"
              >
                <svg
                  class="delete-btn"
                  style="width: 1.6rem; height: 1.8rem"
                  viewBox="0 0 16 18"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M3 18C2.45 18 1.97917 17.8042 1.5875 17.4125C1.19583 17.0208 1 16.55 1 16V3H0V1H5V0H11V1H16V3H15V16C15 16.55 14.8042 17.0208 14.4125 17.4125C14.0208 17.8042 13.55 18 13 18H3ZM13 3H3V16H13V3ZM5 14H7V5H5V14ZM9 14H11V5H9V14Z"
                    fill="#464A61"
                  />
                </svg>
              </button>
            </div>
          </td>
        </tr>
      </template>
    </ReusTable>
  </div>
</template>

<script setup>
import moment from "moment";
import ReusTable from "@/reusables/components/ReusTable.vue";
import { ref, computed, onMounted, defineEmits } from "vue";
import { useAdminStore } from "@/stores/admin/adminStore";

import { storeToRefs } from "pinia";
const { allAdmins, admin } = storeToRefs(useAdminStore());

const emit = defineEmits(["editUser"]);

onMounted(async () => {
  await useAdminStore().getAllAdmins();
});

const toggleStatus = async (id, e) => {
  if (e.target.checked) {
    const res = await useAdminStore().restoreAdmin({ id: id });
    if (!res) {
      e.target.checked = !e.target.checked;
    }
  } else {
    const res = await useAdminStore().destroyAdmin({ id: id });
    if (!res) {
      e.target.checked = !e.target.checked;
    }
  }
  await useAdminStore().getAllAdmins();
};

const removeUser = async (id) => {
  const res = await useAdminStore().deleteAdmin({ id: id });
  await useAdminStore().getAllAdmins();
};

const editUser = async (userId) => {
  let res = await useAdminStore().getAdmin({ id: userId });
  if (res) {
    emit("editUser", admin.value);
  }
};
</script>

<style lang="scss" scoped>
.form-check {
  display: flex !important;
  align-items: center !important;
  justify-content: center !important;
}

button[type="button"] {
  border-radius: 3px !important;
}
</style>
